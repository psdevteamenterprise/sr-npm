{"version":3,"names":["base64url","data","JSON","stringify","toBase64","replace","c","subst","str","isBtoaPatched","btoa","toBinary","e","s","TextEncoder","bytes","encode","Array","from","byte","String","fromCodePoint","join","nonAsciiRegex","toBytes","fromCode","code","fromCharCode","length","cc","charCodeAt"],"sources":["../../../src/utils/base64url.ts"],"sourcesContent":["/* eslint-disable no-control-regex */\n\nexport default function base64url(data: any): string {\n  if (typeof data !== 'string') {\n    data = JSON.stringify(data)\n  }\n\n  return toBase64(data)\n    .replace(/[+/]/g, (c) => subst[c])\n    .replace(/={1,3}$/, '')\n}\n\nfunction toBase64(str: string): string {\n  if (isBtoaPatched()) {\n    return btoa(str)\n  }\n  return btoa(toBinary(str))\n}\n\n// Importing certain packages in Velo (for example 'wix-bookings-backend')\n// patches btoa.\n// https://wix.slack.com/archives/CA5PUAXL5/p1718090111259899\nfunction isBtoaPatched() {\n  try {\n    return btoa('ðŸ¦„') === '8J+mhA=='\n  } catch (e) {\n    return false\n  }\n}\n\nconst subst: Record<string, string> = {\n  '+': '-',\n  '/': '_',\n}\n\nfunction toBinary(s: string) {\n  if (typeof TextEncoder === 'function') {\n    const bytes = new TextEncoder().encode(s)\n    return Array.from(bytes, (byte) => String.fromCodePoint(byte)).join('')\n  }\n\n  return s.replace(nonAsciiRegex, toBytes)\n}\n\nconst nonAsciiRegex = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g\n\nconst fromCode = (code: number) => String.fromCharCode(code)\n\nfunction toBytes(c: string) {\n  if (c.length < 2) {\n    const cc = c.charCodeAt(0)\n    return cc < 0x80\n      ? c\n      : cc < 0x800\n      ? fromCode(0xc0 | (cc >>> 6)) + fromCode(0x80 | (cc & 0x3f))\n      : fromCode(0xe0 | ((cc >>> 12) & 0x0f)) +\n        fromCode(0x80 | ((cc >>> 6) & 0x3f)) +\n        fromCode(0x80 | (cc & 0x3f))\n  }\n  const cc =\n    0x10000 + (c.charCodeAt(0) - 0xd800) * 0x400 + (c.charCodeAt(1) - 0xdc00)\n  return (\n    fromCode(0xf0 | ((cc >>> 18) & 0x07)) +\n    fromCode(0x80 | ((cc >>> 12) & 0x3f)) +\n    fromCode(0x80 | ((cc >>> 6) & 0x3f)) +\n    fromCode(0x80 | (cc & 0x3f))\n  )\n}\n"],"mappings":";;;;AAAA;;AAEe,SAASA,SAASA,CAACC,IAAS,EAAU;EACnD,IAAI,OAAOA,IAAI,KAAK,QAAQ,EAAE;IAC5BA,IAAI,GAAGC,IAAI,CAACC,SAAS,CAACF,IAAI,CAAC;EAC7B;EAEA,OAAOG,QAAQ,CAACH,IAAI,CAAC,CAClBI,OAAO,CAAC,OAAO,EAAGC,CAAC,IAAKC,KAAK,CAACD,CAAC,CAAC,CAAC,CACjCD,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;AAC3B;AAEA,SAASD,QAAQA,CAACI,GAAW,EAAU;EACrC,IAAIC,aAAa,CAAC,CAAC,EAAE;IACnB,OAAOC,IAAI,CAACF,GAAG,CAAC;EAClB;EACA,OAAOE,IAAI,CAACC,QAAQ,CAACH,GAAG,CAAC,CAAC;AAC5B;;AAEA;AACA;AACA;AACA,SAASC,aAAaA,CAAA,EAAG;EACvB,IAAI;IACF,OAAOC,IAAI,CAAC,IAAI,CAAC,KAAK,UAAU;EAClC,CAAC,CAAC,OAAOE,CAAC,EAAE;IACV,OAAO,KAAK;EACd;AACF;AAEA,MAAML,KAA6B,GAAG;EACpC,GAAG,EAAE,GAAG;EACR,GAAG,EAAE;AACP,CAAC;AAED,SAASI,QAAQA,CAACE,CAAS,EAAE;EAC3B,IAAI,OAAOC,WAAW,KAAK,UAAU,EAAE;IACrC,MAAMC,KAAK,GAAG,IAAID,WAAW,CAAC,CAAC,CAACE,MAAM,CAACH,CAAC,CAAC;IACzC,OAAOI,KAAK,CAACC,IAAI,CAACH,KAAK,EAAGI,IAAI,IAAKC,MAAM,CAACC,aAAa,CAACF,IAAI,CAAC,CAAC,CAACG,IAAI,CAAC,EAAE,CAAC;EACzE;EAEA,OAAOT,CAAC,CAACR,OAAO,CAACkB,aAAa,EAAEC,OAAO,CAAC;AAC1C;AAEA,MAAMD,aAAa,GAAG,+CAA+C;AAErE,MAAME,QAAQ,GAAIC,IAAY,IAAKN,MAAM,CAACO,YAAY,CAACD,IAAI,CAAC;AAE5D,SAASF,OAAOA,CAAClB,CAAS,EAAE;EAC1B,IAAIA,CAAC,CAACsB,MAAM,GAAG,CAAC,EAAE;IAChB,MAAMC,EAAE,GAAGvB,CAAC,CAACwB,UAAU,CAAC,CAAC,CAAC;IAC1B,OAAOD,EAAE,GAAG,IAAI,GACZvB,CAAC,GACDuB,EAAE,GAAG,KAAK,GACVJ,QAAQ,CAAC,IAAI,GAAII,EAAE,KAAK,CAAE,CAAC,GAAGJ,QAAQ,CAAC,IAAI,GAAII,EAAE,GAAG,IAAK,CAAC,GAC1DJ,QAAQ,CAAC,IAAI,GAAKI,EAAE,KAAK,EAAE,GAAI,IAAK,CAAC,GACrCJ,QAAQ,CAAC,IAAI,GAAKI,EAAE,KAAK,CAAC,GAAI,IAAK,CAAC,GACpCJ,QAAQ,CAAC,IAAI,GAAII,EAAE,GAAG,IAAK,CAAC;EAClC;EACA,MAAMA,EAAE,GACN,OAAO,GAAG,CAACvB,CAAC,CAACwB,UAAU,CAAC,CAAC,CAAC,GAAG,MAAM,IAAI,KAAK,IAAIxB,CAAC,CAACwB,UAAU,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;EAC3E,OACEL,QAAQ,CAAC,IAAI,GAAKI,EAAE,KAAK,EAAE,GAAI,IAAK,CAAC,GACrCJ,QAAQ,CAAC,IAAI,GAAKI,EAAE,KAAK,EAAE,GAAI,IAAK,CAAC,GACrCJ,QAAQ,CAAC,IAAI,GAAKI,EAAE,KAAK,CAAC,GAAI,IAAK,CAAC,GACpCJ,QAAQ,CAAC,IAAI,GAAII,EAAE,GAAG,IAAK,CAAC;AAEhC","ignoreList":[]}