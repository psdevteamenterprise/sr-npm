{"version":3,"names":["_errors","require","_utils","_baseValidator","ApiValidator","RejectingValidator","arity","method","args","from","to","addValidation","length","messages","invalidArgumentLength","_isObject","item","collectionName","isObject","itemMustBeAnObject","requireId","_id","undefined","isString","updateItemInvalid","items","isArray","every","itemsMustBeArrayOfObjects","itemsMustBeLessThanThousand","fieldName","fieldNameMustBeAString","itemId","itemIdMustBeAString","itemIds","itemIdsMustBeArrayOfStrings","removeItemsMustBeLessThanThousand","_options","options","flags","validOptions","flag","isNonEmptyStringIfDefined","isBooleanIfDefined","optionsInvalid","referenceRemoveParameters","parameters","isRemoveReferenceParameter","referenceOperationParameterError","referenceParameters","isReferenceParameter","referenceParameter","parameter","isNonEmptyString","operand","operandName","queryValidations","references","refs","ref","relationshipName","left","right","invalidReferenceError","bulkInsertOptions","bulkUpdateOptions","bulkRemoveOptions","truncateOptions","collectionNameMustBeAString","apiValidator","errorBuilder","value","isBoolean","hasOwnProperty"],"sources":["../../../src/errors/validations.ts"],"sourcesContent":["import { messages } from './errors'\nimport { isString, isBoolean, isObject, isArray } from '../utils'\nimport { RejectingValidator } from './base-validator'\n\nclass ApiValidator extends RejectingValidator {\n  arity(method: string, args: IArguments, from: number, to: number) {\n    return this.addValidation(\n      () => args.length <= to && args.length >= from,\n      () => messages.invalidArgumentLength(method, from, to, args.length)\n    )\n  }\n\n  _isObject(item: any, collectionName: string) {\n    return this.addValidation(\n      () => isObject(item),\n      () => messages.itemMustBeAnObject(item, collectionName)\n    )\n  }\n\n  item(item: any, collectionName: string, requireId: boolean) {\n    return this._isObject(item, collectionName).addValidation(\n      () => (item._id !== undefined ? isString(item._id) : !requireId),\n      () => messages.updateItemInvalid()\n    )\n  }\n\n  items(items: any, collectionName: string) {\n    return this.addValidation(\n      () =>\n        isArray(items) &&\n        items.every(\n          (item) =>\n            isObject(item) &&\n            (item._id === undefined || item._id === null || isString(item._id))\n        ),\n      () => messages.itemsMustBeArrayOfObjects(collectionName)\n    ).addValidation(\n      () => items.length <= 1000,\n      () => messages.itemsMustBeLessThanThousand(collectionName)\n    )\n  }\n\n  fieldName(fieldName: any) {\n    return this.addValidation(\n      () => isString(fieldName),\n      () => messages.fieldNameMustBeAString()\n    )\n  }\n\n  itemId(itemId: any) {\n    return this.addValidation(\n      () => isString(itemId),\n      () => messages.itemIdMustBeAString()\n    )\n  }\n\n  itemIds(itemIds: any, collectionName: string) {\n    return this.addValidation(\n      () => isArray(itemIds) && itemIds.every((itemId) => isString(itemId)),\n      () => messages.itemIdsMustBeArrayOfStrings()\n    ).addValidation(\n      () => itemIds.length <= 1000,\n      () => messages.removeItemsMustBeLessThanThousand(collectionName)\n    )\n  }\n\n  _options(options: any, flags: string[]) {\n    return this.addValidation(\n      () => {\n        const validOptions =\n          isObject(options) &&\n          flags.every((flag) => {\n            if (flag === 'language') {\n              return isNonEmptyStringIfDefined(options[flag])\n            } else {\n              return isBooleanIfDefined(options[flag])\n            }\n          })\n        return options == null || validOptions\n      },\n      () => messages.optionsInvalid(flags)\n    )\n  }\n\n  referenceRemoveParameters(parameters: any) {\n    return this.addValidation(\n      () => isArray(parameters) && parameters.every(isRemoveReferenceParameter),\n      messages.referenceOperationParameterError\n    )\n  }\n\n  referenceParameters(parameters: any) {\n    return this.addValidation(\n      () => isArray(parameters) && parameters.every(isReferenceParameter),\n      messages.referenceOperationParameterError\n    )\n  }\n\n  referenceParameter(parameter: any) {\n    return this.addValidation(\n      () => isReferenceParameter(parameter),\n      messages.referenceOperationParameterError\n    )\n  }\n\n  isNonEmptyString(operand: any, operandName: string) {\n    return this.addValidation(\n      () => typeof operand === 'string' && operand.length > 0,\n      () => messages.queryValidations.isNonEmptyString(operandName)\n    )\n  }\n\n  references(refs: any) {\n    return this.addValidation(\n      () =>\n        isArray(refs) &&\n        refs.every(\n          (ref) =>\n            isString(ref.relationshipName) &&\n            isReferenceParameter(ref.left) &&\n            isReferenceParameter(ref.right)\n        ),\n      messages.invalidReferenceError\n    )\n  }\n\n  options(options: any) {\n    return this._options(options, [\n      'suppressAuth',\n      'suppressHooks',\n      'showDrafts',\n      'consistentRead',\n      'language',\n    ])\n  }\n\n  bulkInsertOptions(options: any) {\n    return this._options(options, [\n      'suppressAuth',\n      'suppressHooks',\n      'overrideExisting',\n    ])\n  }\n\n  bulkUpdateOptions(options: any) {\n    return this._options(options, [\n      'suppressAuth',\n      'suppressHooks',\n      'showDrafts',\n    ])\n  }\n\n  bulkRemoveOptions(options: any) {\n    return this._options(options, [\n      'suppressAuth',\n      'suppressHooks',\n      'showDrafts',\n    ])\n  }\n\n  truncateOptions(options: any) {\n    return this._options(options, ['suppressAuth'])\n  }\n\n  collectionName(collectionName: any) {\n    return this.addValidation(\n      () => isString(collectionName),\n      () => messages.collectionNameMustBeAString()\n    )\n  }\n}\n\nexport function apiValidator(errorBuilder?: (s: string) => Error) {\n  return new ApiValidator(errorBuilder)\n}\n\nfunction isNonEmptyStringIfDefined(value: any) {\n  return value == null || (isString(value) && value.length > 0)\n}\n\nfunction isBooleanIfDefined(value: any) {\n  return value == null || isBoolean(value)\n}\n\nfunction isReferenceParameter(parameter: any) {\n  return (\n    (isString(parameter) && parameter !== '') ||\n    (isObject(parameter) && parameter.hasOwnProperty('_id'))\n  )\n}\n\nfunction isRemoveReferenceParameter(parameter: any) {\n  return (\n    isString(parameter) ||\n    (isObject(parameter) && parameter.hasOwnProperty('_id'))\n  )\n}\n"],"mappings":"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","ignoreList":[]}