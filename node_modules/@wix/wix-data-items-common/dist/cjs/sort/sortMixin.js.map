{"version":3,"names":["_utils","require","_errors","sortMixin","Base","constructor","obj","_defineProperty2","default","orderBy","invalidArguments","ascending","fields","_sortClause","descending","getSortModel","length","validationError","messages","sortBuilderInvalid","setSortModel","sortModel","_copySort","operatorSymbol","operatorName","args","clone","appendClause","createAppendClauseFn","effectiveArgs","isArray","Array","prototype","slice","call","newInvalidArguments","valid","_sortValidator","arityIsAtLeastOne","allStrings","validateAndAggregate","forEach","SortValidator","destination","direction","field","spec","push","AggregatingValidator","previousInvalidArguments","addValidation","every","isString","sortValidations","typeIsStringOrArrayOfStrings","exports","Sort","_default"],"sources":["../../../src/sort/sortMixin.ts"],"sourcesContent":["import { clone, isString, isArray } from '../utils'\nimport { AggregatingValidator, messages, validationError } from '../errors'\n\nexport type Direction = 'asc' | 'desc'\nexport interface OrderBySpec {\n  [field: string]: Direction\n}\nexport type OrderBy = OrderBySpec[]\n\ninterface WithConstructor {\n  // eslint-disable-next-line @typescript-eslint/prefer-function-type\n  new (...args: any): any\n}\n\nconst sortMixin = (Base: WithConstructor = class {}) =>\n  class extends Base {\n    orderBy: OrderBy\n    invalidArguments: string[]\n\n    constructor(obj: any = {}) {\n      super(obj)\n      this.orderBy = obj.orderBy || []\n      this.invalidArguments = obj.invalidArguments || []\n    }\n\n    ascending(...fields: any[]) {\n      return this._sortClause('asc', '.ascending', fields)\n    }\n\n    descending(...fields: any[]) {\n      return this._sortClause('desc', '.descending', fields)\n    }\n\n    getSortModel() {\n      if (this.invalidArguments.length > 0) {\n        throw validationError(\n          messages.sortBuilderInvalid(this.invalidArguments)\n        )\n      }\n      return this.orderBy\n    }\n\n    setSortModel(sortModel: any[]) {\n      return this._copySort(sortModel, [])\n    }\n\n    _sortClause(operatorSymbol: Direction, operatorName: string, args: any[]) {\n      let orderBy: OrderBy = []\n      if (this.orderBy) {\n        orderBy = clone(this.orderBy)\n      }\n\n      const appendClause = createAppendClauseFn(orderBy, operatorSymbol)\n      const effectiveArgs =\n        isArray(args[0]) && args.length === 1\n          ? args[0]\n          : Array.prototype.slice.call(args, 0)\n      const [newInvalidArguments, valid] = this._sortValidator(operatorName)\n        .arityIsAtLeastOne(args)\n        .allStrings(effectiveArgs)\n        .validateAndAggregate()\n\n      if (valid) {\n        effectiveArgs.forEach(appendClause)\n      }\n\n      return this._copySort(orderBy, newInvalidArguments)\n    }\n\n    _sortValidator(operatorName: string) {\n      return new SortValidator(operatorName, this.invalidArguments)\n    }\n\n    _copySort(orderBy: OrderBy, invalidArguments: string[]) {\n      return new (this.constructor as WithConstructor)({\n        ...this,\n        orderBy,\n        invalidArguments,\n      })\n    }\n  }\n\nfunction createAppendClauseFn(destination: OrderBy, direction: Direction) {\n  return (field: string) => {\n    const spec: OrderBySpec = { [field]: direction }\n    destination.push(spec)\n  }\n}\n\nexport class SortValidator extends AggregatingValidator {\n  constructor(public operatorName: string, previousInvalidArguments: string[]) {\n    super(previousInvalidArguments)\n  }\n\n  allStrings(effectiveArgs: any[]) {\n    return this.addValidation(\n      () => effectiveArgs.every(isString),\n      () => {\n        return messages.sortValidations.typeIsStringOrArrayOfStrings(\n          this.operatorName,\n          effectiveArgs\n        )\n      }\n    )\n  }\n}\n\nexport class Sort extends sortMixin() {}\n\nexport default sortMixin\n"],"mappings":"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","ignoreList":[]}